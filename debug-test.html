<!DOCTYPE html>
<html>
<head>
    <title>Debug Search Results Scanner</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { border: 1px solid #ddd; margin: 10px 0; padding: 10px; position: relative; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .affiliate-warning-icon { 
            position: absolute; 
            top: 5px; 
            right: 5px; 
            background: #ff6b35; 
            color: white; 
            padding: 5px; 
            border-radius: 5px; 
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Search Results Test Page</h1>
    <p>This simulates Google search results to test the affiliate detection.</p>
    
    <!-- Simulate Google search results -->
    <div class="g" data-hveid="test1">
        <h3><a href="https://www.tomsguide.com/best-picks/best-coffee-grinder">Best Coffee Grinders 2024 | Tom's Guide</a></h3>
        <cite>https://www.tomsguide.com/best-picks/best-coffee-grinder</cite>
        <p>Our top picks for the best coffee grinders...</p>
    </div>
    
    <div class="g" data-hveid="test2">
        <h3><a href="https://www.amazon.com/dp/B08N5WRWNW?tag=testaffiliate-20">Coffee Grinder on Amazon</a></h3>
        <cite>https://www.amazon.com/dp/B08N5WRWNW?tag=testaffiliate-20</cite>
        <p>High quality coffee grinder with affiliate link...</p>
    </div>
    
    <div class="g" data-hveid="test3">
        <h3><a href="https://geni.us/coffeegrinder123">Best Coffee Grinder Deal</a></h3>
        <cite>https://geni.us/coffeegrinder123</cite>
        <p>Great deal on coffee grinders via Georiot...</p>
    </div>
    
    <div class="g" data-hveid="test4">
        <h3><a href="https://www.williams-sonoma.com/products/coffee-grinder/">Williams Sonoma Coffee Grinder</a></h3>
        <cite>https://www.williams-sonoma.com/products/coffee-grinder/</cite>
        <p>Regular link without affiliate tracking...</p>
    </div>
    
    <div class="debug">
        <h3>Debug Console</h3>
        <button onclick="testDetection()">Test Affiliate Detection</button>
        <button onclick="simulateScan()">Simulate Search Scan</button>
        <div id="debug-output"></div>
    </div>
    
    <script>
        // Test affiliate detection patterns
        const testUrls = [
            'https://www.amazon.com/dp/B08N5WRWNW?tag=testaffiliate-20',
            'https://amzn.to/3xyz123',
            'https://geni.us/coffeegrinder123',
            'https://www.tomsguide.com/best-picks/best-coffee-grinder',
            'https://www.williams-sonoma.com/products/coffee-grinder/'
        ];
        
        function testDetection() {
            const output = document.getElementById('debug-output');
            output.innerHTML = '<h4>Testing URL Detection:</h4>';
            
            testUrls.forEach(url => {
                const result = testAffiliateLink(url);
                output.innerHTML += `<div>${url}: ${result ? 'AFFILIATE (' + result.type + ')' : 'CLEAN'}</div>`;
            });
        }
        
        function testAffiliateLink(url) {
            try {
                const urlObj = new URL(url);
                const href = url.toLowerCase();
                const search = urlObj.search.toLowerCase();
                const hostname = urlObj.hostname.toLowerCase();
                
                // Amazon detection
                if (/[?&]tag=([a-zA-Z0-9\-_]+)/i.test(search)) return { type: 'amazon', confidence: 'high' };
                if (/^https?:\/\/(amzn\.to|a\.co|amzn\.eu|amzn\.asia)\//i.test(href)) return { type: 'amazon', confidence: 'high' };
                
                // Georiot
                if (/^https?:\/\/geni\.us\//i.test(href)) return { type: 'georiot', confidence: 'high' };
                
                // General affiliate
                if (/[?&](affiliate|aff|partner|ref|utm_source)/i.test(search)) return { type: 'general', confidence: 'medium' };
                
                return null;
            } catch (e) {
                return null;
            }
        }
        
        function simulateScan() {
            const results = document.querySelectorAll('.g');
            const output = document.getElementById('debug-output');
            output.innerHTML = '<h4>Scanning Search Results:</h4>';
            
            results.forEach((element, index) => {
                const link = element.querySelector('a');
                if (link) {
                    const result = testAffiliateLink(link.href);
                    output.innerHTML += `<div>Result ${index + 1}: ${link.href} - ${result ? 'HAS AFFILIATE' : 'CLEAN'}</div>`;
                    
                    if (result) {
                        // Add warning icon
                        if (!element.querySelector('.affiliate-warning-icon')) {
                            const icon = document.createElement('div');
                            icon.className = 'affiliate-warning-icon';
                            icon.textContent = '⚠️';
                            icon.title = 'Contains affiliate links';
                            element.appendChild(icon);
                        }
                    }
                }
            });
        }
        
        console.log('Debug test page loaded. Open browser console for detailed logs.');
    </script>
</body>
</html>